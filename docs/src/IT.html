<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_7rdQntDS3oH37iYV3g8N54"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-2"></span><span class="hs-comment">{-|
Module      : IT
Description : IT expression data structures
Copyright   : (c) Fabricio Olivetti de Franca, 2020
License     : GPL-3
Maintainer  : fabricio.olivetti@gmail.com
Stability   : experimental
Portability : POSIX

An IT expression  represents a function of the form:

\[
f(x) = \sum_{i}{w_i \cdot t_i(\prod_{j}{x_j^{k_{ij}})}}
\]

with \(t_i\) being a transformation function.

Any given expression can be represented by a list of terms, with each term
being composed of a transformatioon function and an interaction.
The transformation function is represented by a `Transformation` sum type.
The interaction is represented as an `IntMap Int` where the key is the 
predictor index and the value is the strength of the predictor in this
term. Strengths with a value of zero are omitted.
-}</span><span>
</span><span id="line-26"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">IT</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intercalate</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.IntMap.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.LinearAlgebra</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LA</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Vector</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V</span></span><span>
</span><span id="line-33"></span><span>
</span><span id="line-34"></span><span class="hs-comment">-- | The 'Interaction' type is a map where</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- a key, value pair (i,p) indicates that the i-th</span><span>
</span><span id="line-36"></span><span class="hs-comment">-- variable should be raised to the power of p.</span><span>
</span><span id="line-37"></span><span class="hs-keyword">type</span><span> </span><span id="Interaction"><span class="annot"><a href="IT.html#Interaction"><span class="hs-identifier hs-var">Interaction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">M.IntMap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- | The 'Transformation' type describes the function that </span><span>
</span><span id="line-40"></span><span class="hs-comment">-- should be evaluated. The evaluation is defined in 'IT.Eval' module.</span><span>
</span><span id="line-41"></span><span class="hs-keyword">data</span><span> </span><span id="Transformation"><span class="annot"><a href="IT.html#Transformation"><span class="hs-identifier hs-var">Transformation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Id"><span class="annot"><a href="IT.html#Id"><span class="hs-identifier hs-var">Id</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Sin"><span class="annot"><a href="IT.html#Sin"><span class="hs-identifier hs-var">Sin</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Cos"><span class="annot"><a href="IT.html#Cos"><span class="hs-identifier hs-var">Cos</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Tan"><span class="annot"><a href="IT.html#Tan"><span class="hs-identifier hs-var">Tan</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Tanh"><span class="annot"><a href="IT.html#Tanh"><span class="hs-identifier hs-var">Tanh</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Sqrt"><span class="annot"><a href="IT.html#Sqrt"><span class="hs-identifier hs-var">Sqrt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="SqrtAbs"><span class="annot"><a href="IT.html#SqrtAbs"><span class="hs-identifier hs-var">SqrtAbs</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Log"><span class="annot"><a href="IT.html#Log"><span class="hs-identifier hs-var">Log</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Exp"><span class="annot"><a href="IT.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Log1p"><span class="annot"><a href="IT.html#Log1p"><span class="hs-identifier hs-var">Log1p</span></a></span></span><span>
</span><span id="line-42"></span><span>                        </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073185"><span id="local-6989586621679073187"><span id="local-6989586621679073189"><span class="annot"><span class="annottext">Int -&gt; Transformation -&gt; ShowS
[Transformation] -&gt; ShowS
Transformation -&gt; String
(Int -&gt; Transformation -&gt; ShowS)
-&gt; (Transformation -&gt; String)
-&gt; ([Transformation] -&gt; ShowS)
-&gt; Show Transformation
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Transformation] -&gt; ShowS
$cshowList :: [Transformation] -&gt; ShowS
show :: Transformation -&gt; String
$cshow :: Transformation -&gt; String
showsPrec :: Int -&gt; Transformation -&gt; ShowS
$cshowsPrec :: Int -&gt; Transformation -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073176"><span id="local-6989586621679073178"><span id="local-6989586621679073180"><span id="local-6989586621679073182"><span class="annot"><span class="annottext">ReadPrec [Transformation]
ReadPrec Transformation
Int -&gt; ReadS Transformation
ReadS [Transformation]
(Int -&gt; ReadS Transformation)
-&gt; ReadS [Transformation]
-&gt; ReadPrec Transformation
-&gt; ReadPrec [Transformation]
-&gt; Read Transformation
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [Transformation]
$creadListPrec :: ReadPrec [Transformation]
readPrec :: ReadPrec Transformation
$creadPrec :: ReadPrec Transformation
readList :: ReadS [Transformation]
$creadList :: ReadS [Transformation]
readsPrec :: Int -&gt; ReadS Transformation
$creadsPrec :: Int -&gt; ReadS Transformation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073171"><span id="local-6989586621679073173"><span class="annot"><span class="annottext">Transformation -&gt; Transformation -&gt; Bool
(Transformation -&gt; Transformation -&gt; Bool)
-&gt; (Transformation -&gt; Transformation -&gt; Bool) -&gt; Eq Transformation
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Transformation -&gt; Transformation -&gt; Bool
$c/= :: Transformation -&gt; Transformation -&gt; Bool
== :: Transformation -&gt; Transformation -&gt; Bool
$c== :: Transformation -&gt; Transformation -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073155"><span id="local-6989586621679073157"><span id="local-6989586621679073159"><span id="local-6989586621679073161"><span id="local-6989586621679073163"><span id="local-6989586621679073165"><span id="local-6989586621679073167"><span class="annot"><span class="annottext">Eq Transformation
Eq Transformation
-&gt; (Transformation -&gt; Transformation -&gt; Ordering)
-&gt; (Transformation -&gt; Transformation -&gt; Bool)
-&gt; (Transformation -&gt; Transformation -&gt; Bool)
-&gt; (Transformation -&gt; Transformation -&gt; Bool)
-&gt; (Transformation -&gt; Transformation -&gt; Bool)
-&gt; (Transformation -&gt; Transformation -&gt; Transformation)
-&gt; (Transformation -&gt; Transformation -&gt; Transformation)
-&gt; Ord Transformation
Transformation -&gt; Transformation -&gt; Bool
Transformation -&gt; Transformation -&gt; Ordering
Transformation -&gt; Transformation -&gt; Transformation
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: Transformation -&gt; Transformation -&gt; Transformation
$cmin :: Transformation -&gt; Transformation -&gt; Transformation
max :: Transformation -&gt; Transformation -&gt; Transformation
$cmax :: Transformation -&gt; Transformation -&gt; Transformation
&gt;= :: Transformation -&gt; Transformation -&gt; Bool
$c&gt;= :: Transformation -&gt; Transformation -&gt; Bool
&gt; :: Transformation -&gt; Transformation -&gt; Bool
$c&gt; :: Transformation -&gt; Transformation -&gt; Bool
&lt;= :: Transformation -&gt; Transformation -&gt; Bool
$c&lt;= :: Transformation -&gt; Transformation -&gt; Bool
&lt; :: Transformation -&gt; Transformation -&gt; Bool
$c&lt; :: Transformation -&gt; Transformation -&gt; Bool
compare :: Transformation -&gt; Transformation -&gt; Ordering
$ccompare :: Transformation -&gt; Transformation -&gt; Ordering
$cp1Ord :: Eq Transformation
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | A 'Term' is the product type of a 'Transformation' and an 'Interaction'.</span><span>
</span><span id="line-45"></span><span class="hs-keyword">data</span><span> </span><span id="Term"><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Term"><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-var">Term</span></a></span></span><span> </span><span class="annot"><a href="IT.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a></span><span> </span><span class="annot"><a href="IT.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span>
</span><span id="line-46"></span><span>              </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073147"><span id="local-6989586621679073149"><span id="local-6989586621679073151"><span class="annot"><span class="annottext">Int -&gt; Term -&gt; ShowS
[Term] -&gt; ShowS
Term -&gt; String
(Int -&gt; Term -&gt; ShowS)
-&gt; (Term -&gt; String) -&gt; ([Term] -&gt; ShowS) -&gt; Show Term
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Term] -&gt; ShowS
$cshowList :: [Term] -&gt; ShowS
show :: Term -&gt; String
$cshow :: Term -&gt; String
showsPrec :: Int -&gt; Term -&gt; ShowS
$cshowsPrec :: Int -&gt; Term -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073139"><span id="local-6989586621679073141"><span id="local-6989586621679073143"><span id="local-6989586621679073145"><span class="annot"><span class="annottext">ReadPrec [Term]
ReadPrec Term
Int -&gt; ReadS Term
ReadS [Term]
(Int -&gt; ReadS Term)
-&gt; ReadS [Term] -&gt; ReadPrec Term -&gt; ReadPrec [Term] -&gt; Read Term
forall a.
(Int -&gt; ReadS a)
-&gt; ReadS [a] -&gt; ReadPrec a -&gt; ReadPrec [a] -&gt; Read a
readListPrec :: ReadPrec [Term]
$creadListPrec :: ReadPrec [Term]
readPrec :: ReadPrec Term
$creadPrec :: ReadPrec Term
readList :: ReadS [Term]
$creadList :: ReadS [Term]
readsPrec :: Int -&gt; ReadS Term
$creadsPrec :: Int -&gt; ReadS Term
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Read</span></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">-- | An 'Expr' is just a list of 'Term's.</span><span>
</span><span id="line-49"></span><span class="hs-keyword">type</span><span> </span><span id="Expr"><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-var">Expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-50"></span><span>
</span><span id="line-51"></span><span class="hs-comment">-- | A 'Column' of a data set is stored as a LA.Vector to avoid conversions</span><span>
</span><span id="line-52"></span><span class="hs-comment">-- during the fitting of the coefficients.</span><span>
</span><span id="line-53"></span><span class="hs-keyword">type</span><span> </span><span id="Column"><span class="annot"><a href="IT.html#Column"><span class="hs-identifier hs-var">Column</span></a></span></span><span> </span><span id="local-6989586621679073136"><span class="annot"><a href="#local-6989586621679073136"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LA.Vector</span></span><span> </span><span class="annot"><a href="#local-6989586621679073136"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">-- | The 'Dataset' is a 'Vector' of 'Column's for efficiency.</span><span>
</span><span id="line-56"></span><span class="hs-comment">-- TODO: try Repa or Accelerate for large data sets.</span><span>
</span><span id="line-57"></span><span class="hs-keyword">type</span><span> </span><span id="Dataset"><span class="annot"><a href="IT.html#Dataset"><span class="hs-identifier hs-var">Dataset</span></a></span></span><span> </span><span id="local-6989586621679073133"><span class="annot"><a href="#local-6989586621679073133"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V.Vector</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Column"><span class="hs-identifier hs-type">Column</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679073133"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-comment">-- | Base interface for converting an expression to string </span><span>
</span><span id="line-60"></span><span class="annot"><a href="IT.html#prettyPrint"><span class="hs-identifier hs-type">prettyPrint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- ^ A function that converts an interaction to a string</span><span>
</span><span id="line-61"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- ^ A function that converts a transformation to a string</span><span>
</span><span id="line-62"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span>                           </span><span class="hs-comment">-- ^ The expression to convert to string </span><span>
</span><span id="line-63"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span>                       </span><span class="hs-comment">-- ^ The fitted coefficients</span><span>
</span><span id="line-64"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>                         </span><span class="hs-comment">-- ^ A string representing the expression </span><span>
</span><span id="line-65"></span><span id="prettyPrint"><span class="annot"><span class="annottext">prettyPrint :: ((Int, Int) -&gt; String)
-&gt; (Transformation -&gt; String) -&gt; [Term] -&gt; [Double] -&gt; String
</span><a href="IT.html#prettyPrint"><span class="hs-identifier hs-var hs-var">prettyPrint</span></a></span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Transformation -&gt; String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="hs-comment">-- empty expression </span><span>
</span><span id="line-66"></span><span class="annot"><a href="IT.html#prettyPrint"><span class="hs-identifier hs-var">prettyPrint</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Transformation -&gt; String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShowS
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERROR: prettyPrint on non fitted expression.&quot;</span></span><span> </span><span class="hs-comment">-- no coefficients </span><span>
</span><span id="line-67"></span><span class="annot"><a href="IT.html#prettyPrint"><span class="hs-identifier hs-var">prettyPrint</span></a></span><span> </span><span id="local-6989586621679073129"><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><a href="#local-6989586621679073129"><span class="hs-identifier hs-var">k2str</span></a></span></span><span> </span><span id="local-6989586621679073128"><span class="annot"><span class="annottext">Transformation -&gt; String
</span><a href="#local-6989586621679073128"><span class="hs-identifier hs-var">t2str</span></a></span></span><span> </span><span id="local-6989586621679073127"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073127"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073126"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073126"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679073125"><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679073125"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Double -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073126"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; + &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073123"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-69"></span><span>    </span><span id="local-6989586621679073123"><span class="annot"><span class="annottext">expr :: String
</span><a href="#local-6989586621679073123"><span class="hs-identifier hs-var hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; + &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double -&gt; ShowS) -&gt; [Double] -&gt; [String] -&gt; [String]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="annot"><span class="annottext">Double -&gt; ShowS
forall a. Show a =&gt; a -&gt; ShowS
</span><a href="#local-6989586621679073121"><span class="hs-identifier hs-var">weight2str</span></a></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679073125"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; String) -&gt; [Term] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; String
</span><a href="#local-6989586621679073120"><span class="hs-identifier hs-var">terms2str</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073127"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>    </span><span id="local-6989586621679073119"><span class="annot"><span class="annottext">interaction2str :: IntMap Int -&gt; String
</span><a href="#local-6989586621679073119"><span class="hs-identifier hs-var hs-var">interaction2str</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><span class="hs-identifier hs-var">intercalate</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String)
-&gt; (IntMap Int -&gt; [String]) -&gt; IntMap Int -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; [String]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (IntMap Int -&gt; [String]) -&gt; IntMap Int -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; String) -&gt; [(Int, Int)] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><a href="#local-6989586621679073129"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, Int)] -&gt; [String])
-&gt; (IntMap Int -&gt; [(Int, Int)]) -&gt; IntMap Int -&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; [(Int, Int)]
forall a. IntMap a -&gt; [(Int, a)]
</span><span class="hs-identifier hs-var">M.toList</span></span><span>
</span><span id="line-72"></span><span>    </span><span id="local-6989586621679073120"><span class="annot"><span class="annottext">terms2str :: Term -&gt; String
</span><a href="#local-6989586621679073120"><span class="hs-identifier hs-var hs-var">terms2str</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span id="local-6989586621679073115"><span class="annot"><span class="annottext">Transformation
</span><a href="#local-6989586621679073115"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679073114"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073114"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Transformation -&gt; String
</span><a href="#local-6989586621679073128"><span class="hs-identifier hs-var">t2str</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="#local-6989586621679073115"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; String
</span><a href="#local-6989586621679073119"><span class="hs-identifier hs-var">interaction2str</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073114"><span class="hs-identifier hs-var">ks</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-73"></span><span>    </span><span id="local-6989586621679073121"><span class="annot"><span class="annottext">weight2str :: a -&gt; ShowS
</span><a href="#local-6989586621679073121"><span class="hs-identifier hs-var hs-var">weight2str</span></a></span></span><span> </span><span id="local-6989586621679073113"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073113"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621679073112"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073112"><span class="hs-identifier hs-var">t</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073113"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;*&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679073112"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- | Converts an expression to a readable format </span><span>
</span><span id="line-76"></span><span class="annot"><a href="IT.html#toExprStr"><span class="hs-identifier hs-type">toExprStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-77"></span><span id="toExprStr"><span class="annot"><span class="annottext">toExprStr :: [Term] -&gt; [Double] -&gt; String
</span><a href="IT.html#toExprStr"><span class="hs-identifier hs-var hs-var">toExprStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; String)
-&gt; (Transformation -&gt; String) -&gt; [Term] -&gt; [Double] -&gt; String
</span><a href="IT.html#prettyPrint"><span class="hs-identifier hs-var">prettyPrint</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
forall a a. (Eq a, Num a, Show a, Show a) =&gt; (a, a) -&gt; String
</span><a href="#local-6989586621679073110"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-79"></span><span>    </span><span id="local-6989586621679073110"><span class="annot"><span class="annottext">k2str :: (a, a) -&gt; String
</span><a href="#local-6989586621679073110"><span class="hs-identifier hs-var hs-var">k2str</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><a href="#local-6989586621679073110"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073109"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073109"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073109"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="#local-6989586621679073110"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073108"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073108"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073107"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073107"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'x'</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; ShowS
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073108"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;^(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073107"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Converts an expression to a numpy compatible format </span><span>
</span><span id="line-84"></span><span class="annot"><a href="IT.html#toPython"><span class="hs-identifier hs-type">toPython</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-85"></span><span id="toPython"><span class="annot"><span class="annottext">toPython :: [Term] -&gt; [Double] -&gt; String
</span><a href="IT.html#toPython"><span class="hs-identifier hs-var hs-var">toPython</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Int, Int) -&gt; String)
-&gt; (Transformation -&gt; String) -&gt; [Term] -&gt; [Double] -&gt; String
</span><a href="IT.html#prettyPrint"><span class="hs-identifier hs-var">prettyPrint</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
forall a a. (Eq a, Num a, Show a, Show a) =&gt; (a, a) -&gt; String
</span><a href="#local-6989586621679073105"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation -&gt; String
</span><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621679073105"><span class="annot"><span class="annottext">k2str :: (a, a) -&gt; String
</span><a href="#local-6989586621679073105"><span class="hs-identifier hs-var hs-var">k2str</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="#local-6989586621679073105"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073103"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073103"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x[:,&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073103"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="#local-6989586621679073105"><span class="hs-identifier hs-var">k2str</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073102"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073102"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679073101"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073101"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x[:,&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073102"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;**(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679073101"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span>    </span><span id="local-6989586621679073104"><span class="annot"><span class="annottext">numpy :: Transformation -&gt; String
</span><a href="#local-6989586621679073104"><span class="hs-identifier hs-var hs-var">numpy</span></a></span></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Id"><span class="hs-identifier hs-var">Id</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Sin"><span class="hs-identifier hs-var">Sin</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.sin&quot;</span></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Cos"><span class="hs-identifier hs-var">Cos</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.cos&quot;</span></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Tan"><span class="hs-identifier hs-var">Tan</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.tan&quot;</span></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Tanh"><span class="hs-identifier hs-var">Tanh</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.tanh&quot;</span></span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Sqrt"><span class="hs-identifier hs-var">Sqrt</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.sqrt&quot;</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#SqrtAbs"><span class="hs-identifier hs-var">SqrtAbs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sqrtAbs&quot;</span></span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Exp"><span class="hs-identifier hs-var">Exp</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.exp&quot;</span></span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Log"><span class="hs-identifier hs-var">Log</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.log&quot;</span></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="#local-6989586621679073104"><span class="hs-identifier hs-var">numpy</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Log1p"><span class="hs-identifier hs-var">Log1p</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;np.log1p&quot;</span></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Two terms are equal if their interactions are equal</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- this instance is used for the mutation operation to avoid adding </span><span>
</span><span id="line-104"></span><span class="hs-comment">-- two interactions with the same value on the same expression. </span><span>
</span><span id="line-105"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679073098"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679073097"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073097"><span class="hs-identifier hs-var">i1</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679073096"><span class="annot"><span class="annottext">== :: Term -&gt; Term -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679073095"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073095"><span class="hs-identifier hs-var">i2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073097"><span class="hs-identifier hs-var">i1</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; IntMap Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073095"><span class="hs-identifier hs-var">i2</span></a></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- * Internal functions</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | remove the i-th term of an expression.</span><span>
</span><span id="line-111"></span><span class="annot"><a href="IT.html#removeIthTerm"><span class="hs-identifier hs-type">removeIthTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span>
</span><span id="line-112"></span><span id="removeIthTerm"><span class="annot"><span class="annottext">removeIthTerm :: Int -&gt; [Term] -&gt; [Term]
</span><a href="IT.html#removeIthTerm"><span class="hs-identifier hs-var hs-var">removeIthTerm</span></a></span></span><span> </span><span id="local-6989586621679073093"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073093"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679073092"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073092"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term] -&gt; [Term]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">take</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073093"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073092"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; [Term] -&gt; [Term]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Term] -&gt; [Term]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073093"><span class="hs-identifier hs-var">i</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073092"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | returns the i-th term of an expression.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="IT.html#getIthTerm"><span class="hs-identifier hs-type">getIthTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span>
</span><span id="line-116"></span><span id="getIthTerm"><span class="annot"><span class="annottext">getIthTerm :: Int -&gt; [Term] -&gt; Maybe Term
</span><a href="IT.html#getIthTerm"><span class="hs-identifier hs-var hs-var">getIthTerm</span></a></span></span><span> </span><span id="local-6989586621679073087"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073087"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span id="local-6989586621679073086"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073086"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073087"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073086"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span>
</span><span id="line-117"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Term
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-118"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Term -&gt; Maybe Term
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073086"><span class="hs-identifier hs-var">terms</span></a></span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int -&gt; Term
forall a. [a] -&gt; Int -&gt; a
</span><span class="hs-operator hs-var">!!</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073087"><span class="hs-identifier hs-var">ix</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-comment">-- | return the interactions of a term</span><span>
</span><span id="line-121"></span><span class="annot"><a href="IT.html#getInteractions"><span class="hs-identifier hs-type">getInteractions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="IT.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span>
</span><span id="line-122"></span><span id="getInteractions"><span class="annot"><span class="annottext">getInteractions :: Term -&gt; IntMap Int
</span><a href="IT.html#getInteractions"><span class="hs-identifier hs-var hs-var">getInteractions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679073082"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073082"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073082"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- | returns the length of an expression as in https://github.com/EpistasisLab/regression-benchmark/blob/dev/CONTRIBUTING.md</span><span>
</span><span id="line-125"></span><span class="annot"><a href="IT.html#exprLength"><span class="hs-identifier hs-type">exprLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Expr"><span class="hs-identifier hs-type">Expr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-126"></span><span id="exprLength"><span class="annot"><span class="annottext">exprLength :: [Term] -&gt; [Double] -&gt; Int
</span><a href="IT.html#exprLength"><span class="hs-identifier hs-var hs-var">exprLength</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-127"></span><span class="annot"><a href="IT.html#exprLength"><span class="hs-identifier hs-var">exprLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int
forall a. HasCallStack =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ERROR: length of unfitted expression.&quot;</span></span><span>
</span><span id="line-128"></span><span class="annot"><a href="IT.html#exprLength"><span class="hs-identifier hs-var">exprLength</span></a></span><span> </span><span id="local-6989586621679073080"><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073080"><span class="hs-identifier hs-var">terms</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679073079"><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073079"><span class="hs-identifier hs-var">b</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679073078"><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679073078"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073077"><span class="hs-identifier hs-var">biasTerm</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073076"><span class="hs-identifier hs-var">addSymbs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073075"><span class="hs-identifier hs-var">weightSymbs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073074"><span class="hs-identifier hs-var">totTerms</span></a></span><span>
</span><span id="line-129"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679073073"><span class="annot"><span class="annottext">nonNullTerms :: [(Double, Term)]
</span><a href="#local-6989586621679073073"><span class="hs-identifier hs-var hs-var">nonNullTerms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Double, Term) -&gt; Bool) -&gt; [(Double, Term)] -&gt; [(Double, Term)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Double -&gt; Bool)
-&gt; ((Double, Term) -&gt; Double) -&gt; (Double, Term) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(Double, Term) -&gt; Double
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Double, Term)] -&gt; [(Double, Term)])
-&gt; [(Double, Term)] -&gt; [(Double, Term)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; [Term] -&gt; [(Double, Term)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679073078"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073080"><span class="hs-identifier hs-var">terms</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679073072"><span class="annot"><span class="annottext">ws' :: [Double]
</span><a href="#local-6989586621679073072"><span class="hs-identifier hs-var hs-var">ws'</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Double, Term) -&gt; Double) -&gt; [(Double, Term)] -&gt; [Double]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Double, Term) -&gt; Double
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Double, Term)]
</span><a href="#local-6989586621679073073"><span class="hs-identifier hs-var">nonNullTerms</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679073071"><span class="annot"><span class="annottext">terms' :: [Term]
</span><a href="#local-6989586621679073071"><span class="hs-identifier hs-var hs-var">terms'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Double, Term) -&gt; Term) -&gt; [(Double, Term)] -&gt; [Term]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Double, Term) -&gt; Term
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">[(Double, Term)]
</span><a href="#local-6989586621679073073"><span class="hs-identifier hs-var">nonNullTerms</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679073077"><span class="annot"><span class="annottext">biasTerm :: Int
</span><a href="#local-6989586621679073077"><span class="hs-identifier hs-var hs-var">biasTerm</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Double
</span><a href="#local-6989586621679073079"><span class="hs-identifier hs-var">b</span></a></span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679073075"><span class="annot"><span class="annottext">weightSymbs :: Int
</span><a href="#local-6989586621679073075"><span class="hs-identifier hs-var hs-var">weightSymbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">[Double] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Double -&gt; Bool) -&gt; [Double] -&gt; [Double]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Double -&gt; Double -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">Double
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Double]
</span><a href="#local-6989586621679073072"><span class="hs-identifier hs-var">ws'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>    </span><span id="local-6989586621679073076"><span class="annot"><span class="annottext">addSymbs :: Int
</span><a href="#local-6989586621679073076"><span class="hs-identifier hs-var hs-var">addSymbs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Term] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073071"><span class="hs-identifier hs-var">terms'</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621679073074"><span class="annot"><span class="annottext">totTerms :: Int
</span><a href="#local-6989586621679073074"><span class="hs-identifier hs-var hs-var">totTerms</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Term -&gt; Int) -&gt; [Term] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Term -&gt; Int
</span><a href="IT.html#termLength"><span class="hs-identifier hs-var">termLength</span></a></span><span> </span><span class="annot"><span class="annottext">[Term]
</span><a href="#local-6989586621679073080"><span class="hs-identifier hs-var">terms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span>
</span><span id="line-138"></span><span class="hs-comment">-- | The length of a term is the interaction length plus 1 if the</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- transformation function is not 'Id'. </span><span>
</span><span id="line-140"></span><span class="annot"><a href="IT.html#termLength"><span class="hs-identifier hs-type">termLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-141"></span><span id="termLength"><span class="annot"><span class="annottext">termLength :: Term -&gt; Int
</span><a href="IT.html#termLength"><span class="hs-identifier hs-var hs-var">termLength</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><a href="IT.html#Id"><span class="hs-identifier hs-var">Id</span></a></span><span> </span><span id="local-6989586621679073067"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073067"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; Int
</span><a href="IT.html#interactionLength"><span class="hs-identifier hs-var">interactionLength</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073067"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-142"></span><span class="annot"><a href="IT.html#termLength"><span class="hs-identifier hs-var">termLength</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="IT.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><span class="annottext">Transformation
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621679073065"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073065"><span class="hs-identifier hs-var">ks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; Int
</span><a href="IT.html#interactionLength"><span class="hs-identifier hs-var">interactionLength</span></a></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073065"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span class="hs-comment">-- | The interaction length is calculated as:</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- +2 for every exponent different from 0 and 1 (^k)</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- +1 for every nonzero exponent, except for the first (*)</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- +1 for every nonzero exponent (x_i)</span><span>
</span><span id="line-148"></span><span class="annot"><a href="IT.html#interactionLength"><span class="hs-identifier hs-type">interactionLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="IT.html#Interaction"><span class="hs-identifier hs-type">Interaction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-149"></span><span id="interactionLength"><span class="annot"><span class="annottext">interactionLength :: IntMap Int -&gt; Int
</span><a href="IT.html#interactionLength"><span class="hs-identifier hs-var hs-var">interactionLength</span></a></span></span><span> </span><span id="local-6989586621679073064"><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073064"><span class="hs-identifier hs-var">ks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073063"><span class="hs-identifier hs-var">mulSymbs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073062"><span class="hs-identifier hs-var">termSymbs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679073061"><span class="hs-identifier hs-var">powSymbs</span></a></span><span>
</span><span id="line-150"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-151"></span><span>    </span><span id="local-6989586621679073060"><span class="annot"><span class="annottext">elems :: [Int]
</span><a href="#local-6989586621679073060"><span class="hs-identifier hs-var hs-var">elems</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; [Int]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; [Int]) -&gt; [Int] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int -&gt; [Int]
forall a. IntMap a -&gt; [a]
</span><span class="hs-identifier hs-var">M.elems</span></span><span> </span><span class="annot"><span class="annottext">IntMap Int
</span><a href="#local-6989586621679073064"><span class="hs-identifier hs-var">ks</span></a></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679073063"><span class="annot"><span class="annottext">mulSymbs :: Int
</span><a href="#local-6989586621679073063"><span class="hs-identifier hs-var hs-var">mulSymbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679073060"><span class="hs-identifier hs-var">elems</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679073062"><span class="annot"><span class="annottext">termSymbs :: Int
</span><a href="#local-6989586621679073062"><span class="hs-identifier hs-var hs-var">termSymbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679073060"><span class="hs-identifier hs-var">elems</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span id="local-6989586621679073061"><span class="annot"><span class="annottext">powSymbs :: Int
</span><a href="#local-6989586621679073061"><span class="hs-identifier hs-var hs-var">powSymbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int -&gt; Bool) -&gt; [Int] -&gt; [Int]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679073060"><span class="hs-identifier hs-var">elems</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span></pre></body></html>